<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin:0; }
    #map { height: 100vh; }
    .popup-form { background: #121212; color: #f1f1f1; font-size: 15px; padding: 14px; border-radius: 10px; min-width: 240px; max-width: 340px; box-sizing: border-box; max-height: 70vh; overflow-y: auto; }
    .popup-form label { display: block; margin-top: 10px; margin-bottom: 4px; color: #ffcc00; font-size: 13px; font-weight: 600; }
    .popup-form input, .popup-form select { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 8px; border: 1px solid #333; background: #1e1e1e; color: #f1f1f1; font-size: 15px; margin-bottom: 6px; }
    .popup-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    .btn { padding: 10px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; }
    .save-btn { background: #ffcc00; color: black; }
    .remove-btn { background: #ef4444; color: white; }
    .add-btn { background: #ffcc00; color: #000; border-radius: 6px; font-weight: 600; margin-bottom: 8px; }
    .multi-list { margin-bottom: 8px; }
    .multi-row { display: flex; gap: 6px; margin-bottom: 4px; }
    .multi-row input { flex: 2; }
    .multi-row input:last-child { flex: 1; }
    .multi-row button { background: #ef4444; color: #fff; border: none; border-radius: 4px; padding: 2px 8px; font-size: 14px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const icons = {
      groomer: L.icon({ iconUrl: 'groomer.png', iconSize:[64,64], iconAnchor:[32,54], popupAnchor:[0,-56] })
    };
    function addMarker(latlng) {
      let marker = L.marker(latlng, { icon: icons.groomer, draggable: true });
      marker.addTo(map);
      function multiListHtml(listId, arr, label) {
        let html = `<div class="multi-list" id="${listId}">`;
        (arr||[]).forEach((item, idx) => {
          html += `<div class="multi-row">
            <input type="text" placeholder="Name" value="${item?.name||''}">
            <input type="text" placeholder="Phone" value="${item?.phone||''}">
            <button type="button" onclick="window.addMultiRowRemove(this)">×</button>
          </div>`;
        });
        html += `</div>
        <button type="button" class="add-btn" onclick="window.addMultiRow('${listId}')">Add ${label}</button>`;
        return html;
      }
      let formHtml = `
        <div class="popup-form">
          <label>Serial</label><input id="serial">
          <label>Size</label><select id="size">
            <option>350</option>
            <option>320</option>
            <option>280</option>
          </select>
          <label>Blade SN</label><input id="blade">
          <label>Tiller SN</label><input id="tiller">
          <label>Status</label><select id="status">
            <option>Working</option>
            <option>Issue</option>
          </select>
          <label>VCU Software</label><input id="vcu">
          <label>Display Software</label><input id="display">
          <label>Battery Software</label><input id="battery">
          <label>EVCC Software</label><input id="evcc">
          <label>VFD Software</label><input id="vfd">
          <label>Ski Area Name</label><input id="skiArea">
          <label>Responsible(s)</label>
          ${multiListHtml('responsibleList', [], 'Responsible')}
          <label>Driver(s)</label>
          ${multiListHtml('driverList', [], 'Driver')}
          <label>Mechanic(s)</label>
          ${multiListHtml('mechanicList', [], 'Mechanic')}
          <div class="popup-actions">
            <button class="btn save-btn">Save</button>
            <button class="btn remove-btn">Remove</button>
          </div>
        </div>`;
      marker.bindPopup(formHtml);
    }
    window.addMultiRow = function(listId) {
      const list = document.getElementById(listId);
      if (!list) return;
      const div = document.createElement('div');
      div.className = 'multi-row';
      div.innerHTML = `<input type="text" placeholder="Name">
        <input type="text" placeholder="Phone">
        <button type="button" onclick="window.addMultiRowRemove(this)">×</button>`;
      list.appendChild(div);
    };
    window.addMultiRowRemove = function(btn) {
      btn.parentNode.remove();
    };
    const map = L.map('map').setView([46.5, 11.3], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);
    map.on('click', function(e) {
      addMarker(e.latlng);
    });
  </script>
</body>
</html>
